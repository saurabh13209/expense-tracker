<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Expense Tracker</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="header">Expense Tracker</div>
  <div class="container">
    <div id="transactions"></div>
    <div id="loader" class="loader" style="display: none;"></div>
  </div>
  <div class="footer">
    <div class="buttons">
      <button id="loadMore">Load More</button>
      <button id="sync">Sync</button>
    </div>
  </div>
  <script>
    const transactionsContainer = document.getElementById('transactions');
    const loadMoreButton = document.getElementById('loadMore');
    const syncButton = document.getElementById('sync');
    const loader = document.getElementById('loader');
    let loading = false;
    let currentPage = 1;

    async function fetchTransactions(page = 1) {
      loading = true;
      loader.style.display = 'block';
      try {
        const response = await fetch(`https://iujebad32f3nbxwmn2g2ybi5nq0irhnx.lambda-url.us-east-2.on.aws/prod/expense-tracker/transactions`, {
          method: 'POST',
          body: JSON.stringify({ page: currentPage })
        });
        const data = await response.json();
        displayTransactions(data.data);
      } catch (error) {
        console.error('Error fetching transactions:', error);
      } finally {
        loader.style.display = 'none';
        loading = false;
      }
    }

    function displayTransactions(transactions) {
      transactions.forEach(item => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'item';
        console.log(item.amount+ item.available_balance)
        itemDiv.innerHTML = `
          <img src=${ item.icon || "https://cdn.pixabay.com/photo/2016/12/27/13/10/logo-1933884_640.png"} alt="icon">
          <div class="item-details">
            <div><strong>${item.title}</strong></div>
            <div>Amount: <span class="amount">₹${item.amount}</span></div>
            <div>Available Balance: <span class="balance">₹${item.available_balance}</span></div>
            <div>Previous Balance: <span class="balance">₹${parseFloat(item.available_balance) + parseFloat(item.amount)}</span></div>
            <div>Date: ${new Date(item.created_at).toLocaleString()}</div>
          </div>
        `;
        
        itemDiv.addEventListener('click', () => {
          // Store the item details in localStorage or redirect with query params
          localStorage.setItem('selectedItem', JSON.stringify(item));
          window.location.href = 'item-details.html';  // Redirect to item detail page
        });

        transactionsContainer.appendChild(itemDiv);
      });
    }

    loadMoreButton.addEventListener('click', () => {
      if (!loading) {
        currentPage++;
        fetchTransactions(currentPage);
      }
    });


    syncButton.addEventListener('click', async ()=>{
        try {
            const response = await fetch('https://iujebad32f3nbxwmn2g2ybi5nq0irhnx.lambda-url.us-east-2.on.aws/prod/expense-tracker/sync', {
                method: 'GET'
            });

            if (response.ok) {
                const data = await response.json();
                alert('Sync Successful: ');  // Show success message
            } else {
                alert('Sync Failed: ');  // Show failure message
            }
        } catch (error) {
            console.error('Error syncing data:', error);
            alert('Sync Failed: ' + error.message);  // Show error message if the fetch fails
        }
    });

    window.onload = fetchTransactions;
  </script>
</body>
</html>
